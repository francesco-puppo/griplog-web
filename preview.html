<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, viewport-fit=cover"
		/>

		<title id="page-title">Shared Route • Griplog</title>
		<meta
			name="description"
			id="page-description"
			content="A climbing route shared from Griplog"
		/>

		<!-- Open Graph -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://griplog.app/preview" />
		<meta
			property="og:title"
			id="og-title"
			content="Check out this climbing route on Griplog"
		/>
		<meta
			property="og:description"
			id="og-description"
			content="A climbing route shared from Griplog"
		/>
		<meta property="og:image" content="https://griplog.app/assets/social.png" />

		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" id="twitter-title" />
		<meta name="twitter:description" id="twitter-description" />
		<meta name="twitter:image" content="https://griplog.app/assets/social.png" />

		<link rel="stylesheet" href="css/styles.css" />
		<link rel="icon" href="assets/favicon.ico" />

		<style>
			/* unchanged styling, trimmed for brevity where irrelevant */

			.map-preview {
				width: 100%;
				height: 200px;
				border-radius: 12px;
				overflow: hidden;
				margin-bottom: 1.5rem;
				background: rgba(255, 255, 255, 0.05);
				border: 1px solid rgba(255, 255, 255, 0.1);
				position: relative;
				cursor: pointer;
			}

			.map-preview img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			.map-preview::after {
				content: "Click to open in OpenStreetMap";
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				padding: 0.5rem;
				font-size: 0.75rem;
				text-align: center;
				background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
				color: rgba(255, 255, 255, 0.8);
				opacity: 0;
				transition: opacity 0.2s ease;
			}

			.map-preview:hover::after {
				opacity: 1;
			}
		</style>
	</head>

	<body>
		<div class="preview-hero">
			<div class="preview-hero-content">
				<img
					src="images/app-icon.png"
					alt="Griplog"
					style="width: 80px; border-radius: 18px"
				/>
				<h1 class="hero-title"><span class="word">Shared Route</span></h1>
			</div>
		</div>

		<section class="content">
			<div class="preview-container">
				<div id="loading-state" class="route-card">
					<div class="error-state">
						<div class="error-icon">⏳</div>
						<div class="error-title">Loading route…</div>
					</div>
				</div>

				<div id="error-state" class="route-card" style="display: none">
					<div class="error-state">
						<div class="error-icon">⚠️</div>
						<div class="error-title">Invalid link</div>
						<p class="error-message">This link is invalid or corrupted.</p>
						<a href="/" class="secondary-button">Back to home</a>
					</div>
				</div>

				<div id="route-display" class="route-card" style="display: none">
					<div class="route-header">
						<div class="route-grade" id="route-grade"></div>
						<div class="route-sport" id="route-sport"></div>
					</div>

					<div class="route-body">
						<h2 class="route-name" id="route-name"></h2>
						<div class="route-details" id="route-details"></div>

						<div class="route-actions">
							<a id="add-to-griplog-btn" class="add-button">Add to Griplog</a>
							<a href="/" class="secondary-button">Explore Griplog</a>
						</div>

						<div class="app-badge">
							<img src="images/app-icon.png" alt="" />
							<span>Shared from Griplog</span>
						</div>
					</div>
				</div>
			</div>
		</section>

		<footer class="footer">© 2025 • Griplog</footer>

		<script>
			const params = new URLSearchParams(location.search);

			const loading = document.getElementById('loading-state');
			const error = document.getElementById('error-state');
			const display = document.getElementById('route-display');

			const grade = params.get('grade');
			const sport = params.get('sport');
			const lat = params.get('lat');
			const lon = params.get('lon');

			if (!grade || !sport) {
			    showError();
			} else {
			    showRoute();
			}

			function showRoute() {
			    loading.style.display = 'none';
			    display.style.display = 'block';

			    route-grade.textContent = grade;
			    route-sport.textContent = formatSport(sport);
			    route-name.textContent = params.get('name') || 'Unnamed Route';

			    const details = document.getElementById('route-details');
			    details.innerHTML = '';

			    if (lat && lon) addMapPreview(lat, lon, details);
			    if (params.get('location')) addDetail('Location', params.get('location'));

			    addToGriplog();
			}

			function addMapPreview(lat, lon, container) {
			    const div = document.createElement('div');
			    div.className = 'map-preview';

			    const zoom = 13;
			    const url =
			        `https://maps.wikimedia.org/img/osm-intl,${zoom},${lat},${lon},600x200.png` +
			        `?lang=en&mark=${lat},${lon},red`;

			    const img = document.createElement('img');
			    img.src = url;
			    img.alt = 'Map location';
			    img.loading = 'lazy';

			    img.onerror = () => {
			        img.remove();
			        div.innerHTML = '<span style="padding:1rem;display:block;color:rgba(255,255,255,.6)">Open map</span>';
			    };

			    div.onclick = () => {
			        window.open(`https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=15/${lat}/${lon}`, '_blank');
			    };

			    div.appendChild(img);
			    container.appendChild(div);
			}

			function addDetail(label, value) {
			    const row = document.createElement('div');
			    row.className = 'detail-row';
			    row.innerHTML = `<span class="detail-label">${label}</span><span class="detail-value">${value}</span>`;
			    route-details.appendChild(row);
			}

			function formatSport(s) {
			    return {
			        bouldering: 'Bouldering',
			        sport: 'Sport Climbing',
			        trad: 'Trad'
			    }[s] || s;
			}

			function addToGriplog() {
			    const q = new URLSearchParams(params);
			    document.getElementById('add-to-griplog-btn').href =
			        `griplog://x-callback-url/route?${q.toString()}`;
			}

			function showError() {
			    loading.style.display = 'none';
			    error.style.display = 'block';
			}
		</script>
	</body>
</html>
